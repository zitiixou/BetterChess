for(var e,t=this&&this.__awaiter||function(e,i,a,s){return new(a=a||Promise)(function(n,t){function o(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,r)}l((s=s.apply(e,i||[])).next())})},u=this&&this.__generator||function(o,r){var l,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(l)throw new TypeError("Generator is already executing.");for(;s;)try{if(l=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(o,s)}catch(e){t=[6,e],i=0}finally{l=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},n=this,p=[],R={bp:"p",br:"r",bn:"n",bq:"q",bb:"b",bk:"k",wp:"P",wr:"R",wn:"N",wq:"Q",wb:"B",wk:"K"},a=[],s="chartreuse",c="red",d="orange",h="blue",i="0.5",g="1",F="1",K="1",o="",l=!1,f="",y=14,_="",W=0,m="",b=!0,v=!0,w=!0,x=!0,H=0,P=0,J=0,k=!0,S=!1,E=!0,C=null,Q="",j="",G="",V="",r=(chrome.storage.local.set({status:"Not Running"}),["controlledByEnemyOpacity","enemyUnderAttackOpacity","selfUnderAttackOpacity","bestMoveOpacity"].forEach(function(t){chrome.storage.sync.get([t]).then(function(e){e[t]&&("controlledByEnemyOpacity"===t?i=(e[t]/100).toString():"enemyUnderAttackOpacity"===t?g=(e[t]/100).toString():"selfUnderAttackOpacity"===t?F=(e[t]/100).toString():"bestMoveOpacity"===t&&(K=(e[t]/100).toString()))})}),chrome.storage.sync.get(["useBigDatabase"]).then(function(e){void 0!==e.useBigDatabase&&(S=e.useBigDatabase)}),chrome.storage.sync.get(["engineDepth","toggleEvalBar","toggleOpeningsExplorer","toggleStockfishSpinner","bulletMode","humanMode","handAndBrain"]).then(function(e){e.engineDepth&&(y=e.engineDepth),void 0!==e.toggleEvalBar&&(b=e.toggleEvalBar),void 0!==e.toggleOpeningsExplorer&&(v=e.toggleOpeningsExplorer),void 0!==e.toggleStockfishSpinner&&(w=e.toggleStockfishSpinner),void 0!==e.bulletMode&&(x=e.bulletMode),void 0!==e.humanMode&&(k=e.humanMode),void 0!==e.handAndBrain&&(E=e.handAndBrain)}),["colourControlledByEnemy","colourEnemyUnderAttack","colourSelfUnderAttack","colourBestMove"].forEach(function(t){chrome.storage.sync.get([t]).then(function(e){e[t]&&("colourControlledByEnemy"===t?d=e[t]:"colourEnemyUnderAttack"===t?s=e[t]:"colourSelfUnderAttack"===t?c=e[t]:"colourBestMove"===t&&(h=e[t]))}).finally(function(){Ae(),Be()})}),(e={})[s]="enemyUnderAttack",e[c]="selfUnderAttack",e[d]="controlledByEnemy",e[h]="bestMove",e),X={enemyUnderAttack:s,selfUnderAttack:c,controlledByEnemy:d,bestMove:h},M={enemyUnderAttack:!0,controlledByEnemy:!0,selfUnderAttack:!0,bestMove:!0},A=(["enemyUnderAttack","controlledByEnemy","selfUnderAttack","bestMove"].forEach(function(t){var n="toggle"+t[0].toUpperCase()+t.substring(1,t.length);chrome.storage.sync.get([n]).then(function(e){!1===e[n]&&(M[t]=!1)})}),"w"),B=0,Y=0,Z=0;Z<8;Z++)p.push(["","","","","","","",""]);var $=function(){ne("")},ee=function(e,t){e=p[e][t];return 2===e.length?{p:"Pawn",r:"Rook",n:"Knight",q:"Queen",b:"Bishop",k:"King"}[e[1]]:""},te=function(){if(!document.querySelector("#handAndBrainContainer")){var e=(e=document.querySelector(".player-tagline"))||document.querySelector(".player-row-container");(C=document.createElement("h1")).id="handAndBrainContainer",C.style="\n  color: white;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);";try{e.insertAdjacentElement("afterend",C)}catch(e){console.log("Caught exception:",e)}}},ne=function(e){if(C)try{C.innerText=e}catch(e){console.log("Caught exception:",e)}},oe=function(){var e,t,n=document.querySelector(".board-layout-evaluation");n&&!document.querySelector("#chessAid-eval")&&((e=document.createElement("div")).style.backgroundColor="#403D39",e.style.height="50%",e.style.width="100%",e.style.position="absolute",e.style.left="0px",e.style.margin="0px",e.id="chessAid-eval",e.style.transition="height 1.5s",(t=document.createElement("span")).innerText="0.0",t.style.position="absolute",t.id="evalText",t.style.margin="0px",t.style.textAlign="center",t.style.width="100%","w"===A?(e.style.top="0px",e.style.bottom="",t.style.color="black",t.style.bottom="0px",t.style.top=""):(e.style.top="",e.style.bottom="0px",t.style.color="white",t.style.top="0px",t.style.bottom=""),n.style.position="relative",n.style.backgroundColor="white",n.appendChild(e),n.appendChild(t))},re=function(){return m?m.split(" ")[1]:"w"},le=function(e){return e?e.split(" ")[1]:"w"},ie=function(e){var t,n,o=document.querySelector("#chessAid-eval");o&&(n=document.querySelector("#evalText"),"M"===e[0]?(n.innerText="-"===e[1]?e[0]+e.substring(2,e.length):e,t=re()!==A?"-"===e[1]?100:0:"-"===e[1]?0:100):(e=parseFloat(e),re()!==A&&0!==e&&(e*=-1),e/=100,t=100/(1+Math.exp(-.25*e)),e<0?(n.style.top="0px",n.style.bottom=""):(n.style.top="",n.style.bottom="0px"),n.innerText=Math.abs(parseFloat(e.toFixed(1))).toString()),0===(t="w"===A?100-t:t)&&(n.style.color="black"),100===t&&(n.style.color="white"),o.style.height=t.toString()+"%","w"===A?(o.style.top="0px",o.style.bottom="",0!==t&&100!==t&&(n.style.color=e<0?"white":"black")):(o.style.top="",o.style.bottom="0px",0!==t&&100!==t&&(n.style.color=e<0?"black":"white")))},ae=function(){document.querySelector("#chessAid-eval")||oe(),ie(H)},se=function(){for(var e=0;e<8;e++)for(var t=0;t<8;t++)p[e][t]=""},ce=function(e,t){for(var n=[],o=p[e][t][0],r=t-1;!(r<0);){if(p[e][r]){p[e][r][0]===A&&o!==A&&I(e,r,c,n),p[e][r][0]!==A&&o===A&&I(e,r,s,n);break}o!==A&&I(e,r,d,n),--r}for(r=t+1;;){if(8<=r)break;if(p[e][r]){p[e][r][0]===A&&o!==A&&I(e,r,c,n),p[e][r][0]!==A&&o===A&&I(e,r,s,n);break}o!==A&&I(e,r,d,n),r+=1}for(var l=e-1;!(l<0);){if(p[l][t]){p[l][t][0]===A&&o!==A&&I(l,t,c,n),p[l][t][0]!==A&&o===A&&I(l,t,s,n);break}o!==A&&I(l,t,d,n),--l}for(l=e+1;;){if(8<=l)break;if(p[l][t]){p[l][t][0]===A&&o!==A&&I(l,t,c,n),p[l][t][0]!==A&&o===A&&I(l,t,s,n);break}o!==A&&I(l,t,d,n),l+=1}return n},de=function(e,t){for(var n=p[e][t][0],o=[],r=0,l=[[-1,-2],[-2,-1],[-2,1],[-1,2],[1,2],[2,1],[2,-1],[1,-2]];r<l.length;r++){var i=l[r];0<=e+i[0]&&0<=t+i[1]&&e+i[0]<8&&t+i[1]<8&&(p[e+i[0]][t+i[1]]?p[e+i[0]][t+i[1]][0]===A&&n!==A?I(e+i[0],t+i[1],c,o):p[e+i[0]][t+i[1]][0]!==A&&n===A&&I(e+i[0],t+i[1],s,o):n!==A&&I(e+i[0],t+i[1],d,o))}return o},ue=function(e,t){for(var n=p[e][t][0],o=[],r=0,l=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];r<l.length;r++){var i=l[r];0<=e+i[0]&&0<=t+i[1]&&e+i[0]<8&&t+i[1]<8&&(p[e+i[0]][t+i[1]]?p[e+i[0]][t+i[1]][0]===A&&n!==A?I(e+i[0],t+i[1],c,o):p[e+i[0]][t+i[1]][0]!==A&&n===A&&I(e+i[0],t+i[1],s,o):n!==A&&I(e+i[0],t+i[1],d,o))}return o},he=function(e,t){for(var n=p[e][t][0],o=[],r=e-1,l=t-1;!(r<0||l<0);){if(p[r][l]){p[r][l][0]===A&&n!==A?I(r,l,c,o):p[r][l][0]!==A&&n===A&&I(r,l,s,o);break}n!==A&&I(r,l,d,o),--r,--l}for(r=e-1,l=t+1;;){if(r<0||8<=l)break;if(p[r][l]){p[r][l][0]===A&&n!==A?I(r,l,c,o):p[r][l][0]!==A&&n===A&&I(r,l,s,o);break}n!==A&&I(r,l,d,o),--r,l+=1}for(r=e+1,l=t-1;;){if(8<=r||l<0)break;if(p[r][l]){p[r][l][0]===A&&n!==A?I(r,l,c,o):p[r][l][0]!==A&&n===A&&I(r,l,s,o);break}n!==A&&I(r,l,d,o),r+=1,--l}for(r=e+1,l=t+1;;){if(8<=r||8<=l)break;if(p[r][l]){p[r][l][0]===A&&n!==A?I(r,l,c,o):p[r][l][0]!==A&&n===A&&I(r,l,s,o);break}n!==A&&I(r,l,d,o),r+=1,l+=1}return o},ge=function(){try{var e=document.getElementsByTagName("chess-board")[0].classList.contains("flipped");A=e?"b":"w"}catch(e){A="w",console.log("Caught error: "+e)}},pe=function(){ge(),b&&oe(),w&&He(),v&&D(!0,"")},fe=function(){var t=!1;if(-1!==window.location.href.indexOf("https://www.chess.com/live")){Y=2;try{t=document.querySelector("#game-board").classList.contains("flipped")}catch(e){t=!1}for(var e=0,n=document.querySelector(".pieces").childNodes;e<n.length;e++){var o=(c=n[e]).classList[1].split("-")[1],r=parseInt(o[1]),l=parseInt(o[3]),i=c.style.backgroundImage.split("/")[7].substring(0,2);ye(t,l,r,i)}}else{try{document.getElementsByTagName("chess-board")[0]?t=document.getElementsByTagName("chess-board")[0].classList.contains("flipped"):document.querySelector("#board")&&(t=!1)}catch(e){alert("ChessAid was not able to find the chess board"),t=!1}for(var a=0,s=document.querySelectorAll(".piece");a<s.length;a++){for(var c,d=(c=s[a]).classList,o="",u="",h=0;h<d.length;h++){var g=d[h];-1!==g.indexOf("square")?o=g.split("-")[1]:2===g.length&&(u=g)}r=parseInt(o[0]),l=parseInt(o[1]);ye(t,l,r,u)}}return A=t?"b":"w",p},ye=function(e,t,n,o){e?p[t-1][8-n]=o:p[8-t][n-1]=o},me=function(e,t){var n=[];return p[e][t][0]!==A?(e+1<8&&0<=t-1&&(p[e+1][t-1]&&p[e+1][t-1][0]===A?I(e+1,t-1,c,n):p[e+1][t-1]||I(e+1,t-1,d,n)),e+1<8&&t+1<8&&(p[e+1][t+1]&&p[e+1][t+1][0]===A?I(e+1,t+1,c,n):p[e+1][t+1]||I(e+1,t+1,d,n))):(e-1<8&&0<=t-1&&p[e-1][t-1]&&p[e-1][t-1][0]!==A&&I(e-1,t-1,s,n),e+1<8&&t+1<8&&p[e-1][t+1]&&p[e-1][t+1][0]!==A&&I(e-1,t+1,s,n)),n},be=function(){for(var e=[],t=0;t<8;t++)for(var n=0;n<8;n++)p[t][n]&&("p"===p[t][n][1]?e=e.concat(me(t,n)):"r"===p[t][n][1]?e=e.concat(ce(t,n)):"b"===p[t][n][1]?e=e.concat(he(t,n)):"q"===p[t][n][1]?e=(e=e.concat(he(t,n))).concat(ce(t,n)):"n"===p[t][n][1]?e=e.concat(de(t,n)):"k"===p[t][n][1]&&(e=e.concat(ue(t,n))));return e},T=function(e,t,n){if(M[n]){var n=X[n],t=t*B,e=e*B,o=document.createElement("div");if(o.className="highlights",o.style.position="absolute",o.style.width=B+"px",o.style.height=B+"px",o.style.background=n,o.style.opacity="1",n===d?o.style.opacity=i:n===s?o.style.opacity=g:n===c?o.style.opacity=F:n===h&&(o.style.opacity=K,o.className+=" bestMove"),o.style.left=t+"px",o.style.top=e+"px",2===Y)document.querySelector(".arrows-container").appendChild(o);else try{document.getElementsByTagName("chess-board")[0].insertBefore(o,document.querySelector(".piece"))}catch(e){document.querySelector("#board").insertBefore(o,document.querySelector(".piece"))}}},ve=function(){for(var e=document.getElementsByClassName("highlights");0<e.length;)e[0].remove()},we=function(){return 0!==document.getElementsByTagName("vertical-move-list").length},xe=function(){setTimeout(function(){var e,t,n=N();z()!==A&&(17<=y||x)?chrome.runtime.sendMessage({kind:"stop"}):n!==_&&(j=le(_=o=n),chrome.storage.local.set({bestMove:""}),e=0,k&&(t=1,9<=y?t=4:8===y?t=3:7<y?t=2:y<5&&(t=0),e=Math.floor(Math.random()*y)+t),t=0===e?y:e,k?chrome.runtime.sendMessage({kind:"fen",content:n,depth:J<10?Math.min(y,17):y,humanMode:k}):chrome.runtime.sendMessage({kind:"fen",content:n,depth:J<10?Math.min(t,17):t,humanMode:k}))},10)},ke=function(e){for(var t=0;t<8;t++)for(var n=0;n<8;n++)if(e[t][n]!==p[t][n])return!0;return!1},Se=function(){if(f){for(var e=document.querySelectorAll(".highlights"),t=0;t<e.length;t++)if(e[t].classList.contains("bestMove"))return!1;return!0}},Ee=function(){if(window.sessionStorage.getItem("interval")){Te();var e=p.map(function(e){return e.slice()}),t=(se(),fe(),N());if(v&&D(!1,t),ke(e)||j!==z()||l||""===f){l=!1,ve();for(var n=0,o=a=be();n<o.length;n++){var r=o[n];T(r[0],r[1],r[2])}xe(),z()!==A&&(f="")}}},q=function(){chrome.storage.local.set({status:"Not Running"}),se(),l=!(a=[]),_=f=o="";var e=window.sessionStorage.getItem("interval");e&&(window.clearInterval(parseInt(e)),ve(),U(),Pe(),Me(),$(),window.sessionStorage.removeItem("interval"))},U=function(){try{var e=document.querySelector("#chessAid-eval"),t=document.querySelector("#evalText"),n=(e&&e.remove(),document.querySelector(".board-layout-evaluation"));n&&(n.style.backgroundColor=""),t&&t.remove()}catch(e){console.log("Caught error: ",e)}},O=function(){return null!==window.sessionStorage.getItem("interval")},Ce=function(){if(q(),chrome.storage.local.set({bestMove:null,eval:0,fen:null,status:"Running"}),l=!(f=""),window.sessionStorage.getItem("interval")&&window.sessionStorage.removeItem("interval"),-1!==window.location.href.indexOf("https://www.chess.com/variants"))return chrome.storage.local.set({status:"Not Running"}),void alert("ChessAid does not work for variants. Please try puzzles or regular chess.");var e;0!==document.getElementsByTagName("canvas").length?alert("ChessAid was not able to find the chess board. Please make sure that animation type is NOT set to Natural or Arcade."):(pe(),e=window.setInterval(Ee,750),window.sessionStorage.setItem("interval",e.toString()))},Me=(chrome.runtime.onMessage.addListener(function(e,t,n){var o,r,l;"start"===e?Ce():"pause"===e?q():"toggleControlledByEnemy"===e?(M.controlledByEnemy=!M.controlledByEnemy,L()):"toggleEnemyUnderAttack"===e?(M.enemyUnderAttack=!M.enemyUnderAttack,L()):"toggleSelfUnderAttack"===e?(M.selfUnderAttack=!M.selfUnderAttack,L()):"toggleBestMove"===e?(M.bestMove=!M.bestMove,L()):e.startsWith("colourChange")?(r=(o=e.split(" "))[1],l=o[2],"colourControlledByEnemy"===r?Oe(l):"colourEnemyUnderAttack"===r?Ue(l):"colourSelfUnderAttack"===r?qe(l):"colourBestMove"===r&&Ne(l),Ae(),Be(),L()):e.startsWith("opacityChange")?(r=(o=e.split(" "))[1],l=o[2],"controlledByEnemyOpacity"===r?i=(l/100).toString():"enemyUnderAttackOpacity"===r?g=(l/100).toString():"selfUnderAttackOpacity"===r?F=(l/100).toString():"bestMoveOpacity"===r&&(K=(l/100).toString()),L()):e.startsWith("depth")?(y=e.split(" ")[1],O()&&(q(),Ce())):"toggleEvalBar"===e?(b=!b)?O()&&ae():U():"toggleOpeningsExplorer"===e?(v=!v)?O()&&D(!0):Me():"toggleStockfishSpinner"===e?(w=!w)?O()&&He():Pe():"bulletMode"===e?x=!x:"humanMode"===e?k=!k:"handAndBrain"===e?(E=!E)?z()===A&&(te(),ne(Q)):$():"are_you_there_content_script?"===e&&n({status:"yes"})}),function(){We("depthSpinnerContainer")});function Ae(){var e={};e[s]="enemyUnderAttack",e[c]="selfUnderAttack",e[d]="controlledByEnemy",e[h]="bestMove",r=e}function Be(){X={enemyUnderAttack:s,selfUnderAttack:c,controlledByEnemy:d,bestMove:h}}function Te(){if(2===Y)document.querySelector(".arrows-container").style.position="relative",B=document.querySelector(".arrows-container").clientHeight/8;else try{document.getElementsByTagName("chess-board")[0].style.position="relative",B=document.getElementsByTagName("chess-board")[0].clientHeight/8}catch(e){document.querySelector("#board").style.position="relative",B=document.querySelector("#board").clientHeight/8}}var qe=function(e){c=e},Ue=function(e){s=e},Oe=function(e){d=e},Ne=function(e){h=e},N=function(){for(var e="",t=0;t<p.length;t++){for(var n=0,o="",r=0;r<p[t].length;r++){var l=!0;(l="w"===A&&0!==p[t][r].length||"b"===A&&0!==p[7-t][7-r].length?!1:l)?n++:(0!==n&&(o+=n),o+="w"===A?R[p[t][r]]:R[p[7-t][7-r]],n=0)}0!=n&&(o+=n),e+=o,t!==p.length-1?e+="/":e+=" "}return e=(e+=z())+(" "+Ie())+" - 0 1"},z=function(){if(-1!==window.location.href.indexOf("https://www.chess.com/puzzles"))return A;try{var e=document.querySelectorAll(".move");e&&(J=e.length);var t=e[e.length-1].children;t[0].classList.contains("game-result")&&(t=e[e.length-2].children);for(var n=0;n<t.length;n++)if(t[n].classList.contains("black"))return"w";return"b"}catch(e){return"w"}},ze=function(){for(var e=!0,t=!0,n=document.querySelectorAll(".white.node"),o=0;o<n.length;o++){var r=n[o],l=r.innerText,r=r.children,i=!1,a=!1;if(0<r.length&&(i=Array.from(r[0].classList).includes("rook-white"),a=Array.from(r[0].classList).includes("king-white")),l.includes("K")||a||l.includes("O"))return"";(i||l.includes("R"))&&(l.includes("h")||l.includes("g1")||l.includes("f1")?e=!1:(l.includes("a")||l.includes("b1")||l.includes("c1")||l.includes("d1"))&&(t=!1))}var s=e?"K":"";return s+=t?"Q":""},Le=function(){for(var e=!0,t=!0,n=document.querySelectorAll(".black.node"),o=0;o<n.length;o++){var r=n[o],l=r.innerText,r=r.children,i=!1,a=!1;if(0<r.length&&(i=Array.from(r[0].classList).includes("rook-black"),a=Array.from(r[0].classList).includes("king-black")),l.includes("K")||a||l.includes("O"))return"";(i||l.includes("R"))&&(l.includes("h")||l.includes("g8")||l.includes("f8")?e=!1:(l.includes("a")||l.includes("b8")||l.includes("c8")||l.includes("d8"))&&(t=!1))}var s=e?"k":"";return s+=t?"q":""},Ie=function(){if(-1!==window.location.href.indexOf("https://www.chess.com/puzzles"))return"-";var e=ze()+Le();return""!==e?e:"-"},De=function(){for(var e=[],t=0;t<a.length;t++)"bestMove"===a[t][2]&&e.push(t);for(var n=0,o=0,r=e;o<r.length;o++){var l=r[o];a.splice(l-n,1),n++}for(var i=document.getElementsByClassName("highlights bestMove");0<i.length;)i[0].remove()},L=(chrome.storage.onChanged.addListener(function(d,e){return t(this,void 0,void 0,function(){var t,n,o,r,l,i,a,s,c;return u(this,function(e){switch(e.label){case 0:t={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},e.label=1;case 1:return(e.trys.push([1,7,,8]),n=N(),"bestMove"in d&&""!==d.bestMove.newValue)?[4,chrome.storage.local.get(["bestMove","eval","fen","depth","searchComplete"])]:[3,3];case 2:return(s=e.sent(),console.log("res is",JSON.stringify(s)),s.fen!==n)?[2]:(m=n,H=s.eval,Je(s.depth,s.searchComplete),(b?ae:U)(),re()===A&&(f=s.bestMove,c=s.bestMove.substring(0,2),o=s.bestMove.substring(2,4),r=8-c[1],l=t[c[0]],i=8-o[1],a=t[o[0]],a="w"===A?(r=8-c[1],l=t[c[0]],i=8-o[1],t[o[0]]):(r=c[1]-1,l=7-t[c[0]],i=o[1]-1,7-t[o[0]]),De(),Re(r,l,h),Re(i,a,h),T(r,l,"bestMove"),T(i,a,"bestMove"),Q=ee(r,l),E&&(C||te(),ne(Q))),[3,6]);case 3:return"depth"in d?[4,chrome.storage.local.get(["fen","depth","bestMove","searchComplete","eval"])]:[3,5];case 4:return(s=e.sent(),console.log("bestMove not in changes. res is",JSON.stringify(s)),s.fen!==n)?[2]:(m=n,H=s.eval,(b?ae:U)(),Je(s.depth,s.searchComplete),[3,6]);case 5:"searchComplete"in d&&(console.log("SEARCHCOMPLETE",d.searchComplete.newValue),Je(-1,!0)),e.label=6;case 6:return[3,8];case 7:return c=e.sent(),console.log("Caught type error, resending: "+c),c instanceof TypeError&&(chrome.storage.local.set({bestMove:null,eval:0,fen:null}),xe()),[3,8];case 8:return[2]}})})}),window.onresize=function(){L()},function(){Te(),ve();for(var e=0,t=a;e<t.length;e++){var n=t[e];T(n[0],n[1],n[2])}}),Re=function(e,t,n){n=r[n];a.push([e,t,n])},I=function(e,t,n,o){r[n];o.push([e,t,r[n]])},Fe=function(o,r){return void 0===r&&(r=!1),t(n,void 0,void 0,function(){var t,n;return u(this,function(e){return t=Ke(o),console.log("Getting openings with url:",t),n=r?"https://explorer.lichess.ovh/lichess?variant=standard&fen=":"https://explorer.lichess.ovh/master?fen=",[2,fetch("".concat(n).concat(t)).then(function(e){return e.json()}).then(function(e){return e.moves.map(function(e){return{move:e.san,white:e.white,black:e.black,draws:e.draws}})})]})})},Ke=function(e){return e.replace(/ /g,"_")},_e=function(e){return 1e6<e?Math.round(e/1e6)+"M":1e3<e?Math.round(e/1e3)+"K":e.toString()},We=function(e){var t=document.querySelector("#board-layout-ad");if(t&&t.childNodes){for(var n=[],o=0;o<t.childNodes.length;o++){var r=t.childNodes[o];r.classList&&Array.from(r.classList).includes(e)||n.push(r)}n.forEach(function(e){return e.remove()})}},He=function(){try{var e=document.querySelector(".board-layout-sidebar"),t=e.getBoundingClientRect().x,n=e.offsetWidth,o=document.querySelector("#board-layout-ad"),r=(o.style.position="absolute",o.style.left=t+n+10+"px",o.style.width=window.innerWidth-(t+n+40)+"px",o.style.margin="0px",o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",We("openingsContainer"),document.createElement("div")),l=(r.className="depthSpinnerContainer",r.style.cssText="\n position: relative;\n display: inline-block;\n margin-bottom: 18px;\n ",document.createElement("div")),i=(l.id="loader",l.style.cssText="  \n border: 16px solid #f3f3f3;\n  border-top: 16px solid #3498db;\n  border-radius: 50%;\n  width: 120px;\n  height: 120px;\n  animation: spin 2s linear infinite;\n  display: block;\n ",document.createElement("div")),a=(i.id="loader-text",i.style.cssText="position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  margin: 0;\n  color:white;",-1===P?(i.innerText="Search Complete",l.style.border="16px solid #3498db"):i.innerText="Depth\n".concat(P),document.createElement("style"));a.innerHTML="@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }",document.getElementsByTagName("head")[0].appendChild(a),r.appendChild(l),r.appendChild(i),o.insertBefore(r,o.firstChild)}catch(e){console.log("Caught error:",e)}},Pe=function(){var e=document.querySelector(".depthSpinnerContainer");e&&e.remove()},Je=function(e,t){P=(t=void 0===t?!1:t)?-1:e;try{var n=document.querySelector("#loader-text"),o=document.querySelector("#loader");t&&o?(o.style.border="16px solid #3498db",n.innerText="Search Complete"):o&&(o.style.border="16px solid #f3f3f3",o.style.borderTop="16px solid #3498db",n.innerText="Depth\n".concat(e))}catch(e){console.log("Caught error:",e)}},D=function(a,c){return void 0===a&&(a=!1),void 0===c&&(c=""),t(n,void 0,void 0,function(){var t,n,o,s,r,l,i;return u(this,function(e){switch(e.label){case 0:if((t=""!==c?c:N())===G&&!a)return[2];G=t;try{S=document.querySelector("#openingsExplorerToggle").checked}catch(e){console.log("Caught exception: ",e)}return[4,Fe(t,S)];case 1:return(n=e.sent(),console.log("Openings are",JSON.stringify(n)),G!==t)?[2]:(r=document.querySelector(".board-layout-sidebar"),l=r.getBoundingClientRect().x,r=r.offsetWidth,(o=document.querySelector("#board-layout-ad")).style.position="absolute",o.style.left=l+r+10+"px",o.style.width=window.innerWidth-(l+r+40)+"px",o.style.margin="0px",o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",We("depthSpinnerContainer"),s=document.createElement("div"),(l=document.createElement("h2")).innerText="Openings Explorer",l.style.color="white",s.appendChild(l),(r=document.createElement("label")).className="toggleSwitch nolabel",l=S?"checked":"",r.innerHTML="<input id='openingsExplorerToggle' type=\"checkbox\" ".concat(l,' />\n<a></a>\n<span>\n  <span class="left-span">Masters</span>\n  <span class="right-span">All</span>\n</span>\t\t\t\t\t'),(l=document.createElement("style")).type="text/css",l.innerHTML="\n\n.toggleSwitch span span {\n\tdisplay: none;\n}  \n  \n.toggleSwitch {\n\tdisplay: inline-block;\n\theight: 18px;\n\tposition: relative;\n\toverflow: visible;\n\tpadding: 0;\n\tcursor: pointer;\n\twidth: 100%;\n\tbackground-color: #fafafa;\n\tborder: 1px solid #ccc;\n\tborder-radius:5px;\n\theight:34px;\n}\n.toggleSwitch * {\n\t-webkit-box-sizing: border-box;\n\t-moz-box-sizing: border-box;\n\tbox-sizing: border-box;\n}\n.toggleSwitch label,\n.toggleSwitch > span {\n\tline-height: 20px;\n\theight: 20px;\n\tvertical-align: middle;\n}\n.toggleSwitch input:focus ~ a,\n.toggleSwitch input:focus + label {\n\toutline: none;\n}\n.toggleSwitch label {\n\tposition: relative;\n\tz-index: 3;\n\tdisplay: block;\n\twidth: 100%;\n}\n.toggleSwitch input {\n\tposition: absolute;\n\topacity: 0;\n\tz-index: 5;\n}\n.toggleSwitch > span {\n\tposition: absolute;\n\tleft: 0;\n\twidth: calc(100% - 6px);\n\tmargin: 0;\n\ttext-align: left;\n\twhite-space: nowrap;\n  margin:0 3px;\n}\n.toggleSwitch > span span {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tz-index: 5;\n\tdisplay: block;\n\twidth: 50%;\n\tmargin-left: 50px;\n\ttext-align: left;\n\tfont-size: 0.9em;\n\twidth: auto;\n\tleft: 0;\n\ttop: -1px;\n\topacity: 1;\n\twidth:40%;\n\ttext-align: center;\n  line-height:34px;\n}\n.toggleSwitch a {\n\tposition: absolute;\n\tright: 50%;\n\tz-index: 4;\n\tdisplay: block;\n\ttop: 3px;\n\tbottom: 3px;\n\tpadding: 0;\n\tleft: 3px;\n\twidth: 50%;\n\tbackground-color: #666;\n\tborder-radius: 4px;\n\t-webkit-transition: all 0.2s ease-out;\n\t-moz-transition: all 0.2s ease-out;\n\ttransition: all 0.2s ease-out;\n\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n}\n.toggleSwitch > span span:first-of-type {\n\tcolor: #FFF;\n\topacity: 1;\n\tleft: 0;\n\tmargin: 0;\n    width: 50%;\n}\n.toggleSwitch > span span:last-of-type {\n\tleft:auto;\n\tright:0;\n\tcolor: #999;\n\tmargin: 0;\n    width: 50%;\n}\n.toggleSwitch > span:before {\n\tcontent: '';\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tposition: absolute;\n\tleft: 0;\n\ttop: -2px;\n\t/* background-color: #fafafa;\n\tborder: 1px solid #ccc; */\n\tborder-radius: 30px;\n\t-webkit-transition: all 0.2s ease-out;\n\t-moz-transition: all 0.2s ease-out;\n\ttransition: all 0.2s ease-out;\n}\n.toggleSwitch input:checked ~ a {\n\tleft: calc(50% - 3px);\n}\n.toggleSwitch input:checked ~ span:before {\n\t/* border-color: #0097D1;\n\tbox-shadow: inset 0 0 0 30px #0097D1; */\n}\n.toggleSwitch input:checked ~ span span:first-of-type {\n\tleft:0;\n\tcolor:#999;\n}\n.toggleSwitch input:checked ~ span span:last-of-type {\n\t/* opacity: 1;\n\tcolor: #fff;\t */\n\tcolor:#FFF;\n}\n/* Switch Sizes */\n.toggleSwitch.large {\n\twidth: 60px;\n\theight: 27px;\n}\n.toggleSwitch.large a {\n\twidth: 27px;\n}\n.toggleSwitch.large > span {\n\theight: 29px;\n\tline-height: 28px;\n}\n.toggleSwitch.large input:checked ~ a {\n\tleft: 41px;\n}\n.toggleSwitch.large > span span {\n\tfont-size: 1.1em;\n}\n.toggleSwitch.large > span span:first-of-type {\n\tleft: 50%;\n}\n.toggleSwitch.xlarge {\n\twidth: 80px;\n\theight: 36px;\n}\n.toggleSwitch.xlarge a {\n\twidth: 36px;\n}\n.toggleSwitch.xlarge > span {\n\theight: 38px;\n\tline-height: 37px;\n}\n.toggleSwitch.xlarge input:checked ~ a {\n\tleft: 52px;\n}\n.toggleSwitch.xlarge > span span {\n\tfont-size: 1.4em;\n}\n.toggleSwitch.xlarge > span span:first-of-type {\n\tleft: 50%;\n}\n\n  /*  End Toggle Switch  */",document.head.appendChild(l),s.appendChild(r),(l=document.createElement("div")).innerText="Win rate % by move",l.style.color="white",l.style.marginBottom="5px",s.appendChild(l),s.className="openingsContainer",s.style.width="100%",n.forEach(function(e){var t=e.white+e.black+e.draws,n=_e(t),o=document.createElement("div"),n=(o.innerText=n,o.style.position="absolute",o.style.bottom="0px",o.style.left="0px",o.style.fontSize="11px",document.createElement("div")),r=(n.style.display="flex",n.style.marginBottom="5px",document.createElement("span")),l=(r.innerText="".concat(e.move),r.style.marginRight="5px",r.style.color="white",r.style.width="50px",document.createElement("div")),i=e.white/t*100,i=(l.style.width=i+"%",l.style.backgroundColor="white",l.style.height="30px",l.innerText=5<=i?Math.round(i).toString():"",l.style.textAlign="center",l.style.color="black",document.createElement("div")),a=e.black/t*100,a=(i.style.width=a+"%",i.style.backgroundColor="black",i.style.height="30px",i.innerText=5<=a?Math.round(a).toString():"",i.style.textAlign="center",i.style.color="white",document.createElement("div")),e=e.draws/t*100,t=(a.style.width=e+"%",a.style.backgroundColor="grey",a.style.height="30px",a.innerText=5<=e?Math.round(e).toString():"",a.style.textAlign="center",a.style.color="white",a.style.zIndex="5",document.createElement("div"));t.style.width="100%",t.style.display="flex",t.style.position="relative","w"===A?(t.appendChild(l),t.appendChild(a),t.appendChild(i),o.style.color="black"):(t.appendChild(i),t.appendChild(a),t.appendChild(l),o.style.color="white"),t.appendChild(o),n.appendChild(r),n.appendChild(t),s.appendChild(n)}),o.appendChild(s),(i=document.querySelector("#openingsExplorerToggle"))&&i.addEventListener("click",function(){S=i.checked,chrome.storage.sync.set({useBigDatabase:S}),v&&D(!0)}),[2])}})})};document.addEventListener("keydown",function(e){e.ctrlKey&&"b"===e.key&&(M.bestMove=!M.bestMove,chrome.storage.sync.set({toggleBestMove:M.bestMove}),L())}),document.addEventListener("keydown",function(e){e.ctrlKey&&"v"===e.key&&(O()?q:Ce)()});